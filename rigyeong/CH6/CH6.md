# 응용 서비스와 표현 영역

## 6.1 표현 영역과 응용 영역
![](https://github.com/rigyeonghong/FunDDD/blob/main/rigyeong/CH6/Pasted%20image%2020240301155415.png)

* 표현 영역 : 사용자의 요청 해석. ex. url, 요청 파라미터, 쿠키, 헤더 등으로 사용자 원하는 기능 판별 후 응용서비스 실행.
* 응용 영역 : 실제 사용자가 원하는 기능 제공.

## 6.2 응용 서비스의 역할

* 사용자 요청 처리 위해 리포지터리에서 도메인 객체 가져와 사용.
* 새로운 애그리거트 생성.
* 트랜잭션 처리 담당.
* 접근 제어와 이벤트 처리.

* 응용 서비스가 도메인 로직을 일부 구현시 **로직 분산, 코드 중복** 등 코드 품질에 좋지 않음.
	* ex. 암호 변경 :
		기존 암호를 올바르게 입력했는지 확인 하는 것은 도메인 핵심 로직이므로, 응용서비스에서 해당 로직 구현하면 안됨.
		➡️ **암호 데이터 가진 Member 객체(도메인 영역)에 암호 확인 기능 구현.**

## 6.3 응용 서비스의 구현

* 응용 서비스 : 표현 영역과 도메인 영역 연결하는 매개체. 마치 파사드 패턴.
* 응용 서비스 구현시 고려사항, 트랜잭션 같은 구현 기술 연동에 대해.

#### 1. 응용 서비스의 크기
* 한 응용 서비스 클래스에 회원 도메인의 모든 기능 구현할까
	* 장점 : 동일 로직 위한 코드 중복 제거 
	* 단점 : 서비스 클래스 크기 커지며 연관성 적은 코드가 위치할 가능성 높아짐.
* 구분되는 기능별 응용 서비스 클래스 따로 구현할까
	* 장점 :  코드 품질 일정 수준으로 유지 가능, 의존 객체만 포함하므로 다른 기능 구현 코드에 영향 안받음.
	* 단점 : 클래스 개수 많음, 여러 클래스에 중복 코드 존재 가능.
		➡️ 별도 클래스에 로직 구현으로 방지. ex. MemberServiceHelper
		
#### 2. 응용 서비스의 인터페이스와 클래스
* 인터페이스가 필요한가?
	* 구현 클래스가 여러 개고 런타임에 구현 객체 교체시 필요하나 드물다.
	* 소스 파일만 많고 구현 클래스 간접 참조 증가로 복잡도 증가.. 비추..
	* 표현 영역 단위 테스트 위한 응용 서비스 인터페이스는 mockito 같은 도구로 대체 가능.

#### 3. 메서드 파라미터와 값 리턴
* 응용 서비스는 표현 영역에서 필요한 데이터만 리턴하는 것이 기능 실행 로직의 응집도 높이는 방법.

#### 4. 표현 영역에 의존하지 않기
* 응용 서비스의 파라미터 타입 결정시, 표현 영역과 관련 타입 사용하면 안됨.
	* 응용 서비스 단독 테스트 어려움
	* 표현 영역 구현 변경시 응용 서비스도 함께 변경..
	* 응용 서비스가 표현 영역 역할까지 대신해 추적의 어려움.

#### 5. 트랜잭션 처리
* 스프링 같은 프레임워크 제공 트랜잭션 관리 기능으로 쉽게 처리 가능.
	* 간단한 설정으로 커밋, 익셉션 발생시 롤백하므로.


## 6.4 표현 영역

##### 책임
1. 사용자가 시스템 사용할 수 있는 흐름(화면) 제공 및 제어.
2. 사용자 요청을 알맞는 응용 서비스에 전달 후 결과를 사용자에 제공.
	ex. MVC 프레임워크 : http 요청 파라미터로부터 자바 객체 생성 기능 지원.
3. 사용자의 세션 관리.
	(뒤에서 다룸..)

## 6.5 값 검증

* 표현 영역과 응용 서비스에서 모두 수행 가능.
	* 응용 서비스 수행 : 원칙적

	ex. 사용자 입력 폼 에러시
		사용자 편의 위해 응용 서비스에서 에러 목록으로 모아 하나의 익셉션으로 발생시킴
		-> 표현 영역은 에러 목록 가져와 표현 영역의 형태로 변환 처리.
```java
        catch(ValidationErrorException e){
			e.getErrors().forEach(err -> {
				if(err.hasName()){
					bindingResult.rejectValue(err.getName(), err.getCode());
				} ...
			});
			populateProductsModel(orderRequest, modelMap);
			return "order/confirm";
		}```

ex2. 표현 영역에서 필수 값 검증도 가능.
* 스프링 프레임워크 Validator 인터페이스 통해 간결하게 표현 가능.
	
ex3. 구현의 편리함 위해 표현 영역과 응용 서비스가 값 나눠 수행.

## 6.6 권한 검사

* 스프링 시큐리티 프레임워크 : 유연, 확장 가능, 복잡
* 개발 시스템에 맞는 권한 검사 기능 구현 : 시스템 유지 보수에 유리
	* 권한 검사 수행할 수 있는 곳
		* 표현 영역 : 인증된 사용자인지 검사. ex. 회원 정보 변경
			* `서블릿 필터` : 사용자 인증 정보 생성 및 url별 권한 검사
		* 응용 서비스 : url 만으로 접근제어 불가시, 응용 서비스 메서드 단위로 권한 검사.
			* ex. 스프링 시큐리티 AOP 활용해 @PreAuthorize를 사용한 권한 검사
		* 도메인 : 개별 도메인 객체 단위로 권한 검사. ex. 게시글 삭제.

## 6.7 조회 전용 기능과 응용 서비스

* 서비스에서 수행하는 추가 로직 없이 단일 쿼리만 실행한다면 표현 영역(controller)에서 바로 조회 전용 기능 사용해도 괜찮다.